<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - STORIA</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="dashboard-nav">
        <div class="nav-brand">STORIA - Administration</div>
        <div class="nav-menu">
            <span class="nav-user" id="adminUsername">Admin</span>
            <a href="#" id="logoutBtn" class="nav-link">D√©connexion</a>
        </div>
    </nav>

    <div class="container">
        <div class="page-header fade-in">
            <h1>Panel Administrateur</h1>
            <p>Gestion de la plateforme STORIA</p>
        </div>

        <div class="tabs glass-card">
            <button class="tab-btn active" data-tab="dashboard">üìä Dashboard</button>
            <button class="tab-btn" data-tab="stats">üìà Statistiques</button>
            <button class="tab-btn" data-tab="themes">Th√®mes</button>
            <button class="tab-btn" data-tab="questions">Questions</button>
            <button class="tab-btn" data-tab="users">üë• Utilisateurs</button>
            <button class="tab-btn" data-tab="reclamations">üìÆ R√©clamations</button>
        </div>

        <!-- DASHBOARD TAB -->
        <div class="tab-content" id="dashboardTab">
            <div class="admin-dashboard-grid">
                <!-- Vue d'ensemble rapide -->
                <div class="glass-card fade-in">
                    <h2>üìä Vue d'ensemble</h2>
                    <div class="admin-stats-grid">
                        <div class="admin-stat-card glass-card">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-value" id="dash-totalUsers">0</div>
                            <div class="stat-label">Utilisateurs</div>
                        </div>
                        <div class="admin-stat-card glass-card">
                            <div class="stat-icon"></div>
                            <div class="stat-value" id="dash-totalThemes">0</div>
                            <div class="stat-label">Th√®mes</div>
                        </div>
                        <div class="admin-stat-card glass-card">
                            <div class="stat-icon"></div>
                            <div class="stat-value" id="dash-totalQuestions">0</div>
                            <div class="stat-label">Questions</div>
                        </div>
                        <div class="admin-stat-card glass-card">
                            <div class="stat-icon">üéØ</div>
                            <div class="stat-value" id="dash-totalQuizzes">0</div>
                            <div class="stat-label">Quiz Jou√©s</div>
                        </div>
                    </div>
                </div>

                <!-- Actions rapides -->
                <div class="glass-card fade-in">
                    <h2>‚ö° Actions rapides</h2>
                    <div class="quick-actions">
                        <button class="btn btn-primary btn-block" onclick="switchTab('themes')">
                            G√©rer les th√®mes
                        </button>
                        <button class="btn btn-primary btn-block" onclick="switchTab('questions')">
                            Ajouter des questions
                        </button>
                        <button class="btn btn-primary btn-block" onclick="switchTab('users')">
                            üë• G√©rer les utilisateurs
                        </button>
                        <button class="btn btn-secondary btn-block" onclick="switchTab('stats')">
                            üìà Voir statistiques d√©taill√©es
                        </button>
                    </div>
                </div>

                <!-- Activit√© r√©cente -->
                <div class="glass-card fade-in">
                    <h2>üïê Activit√© r√©cente</h2>
                    <div id="recentActivity" class="recent-activity-list">
                        <div class="loading-spinner"></div>
                    </div>
                </div>

                <!-- Classement des joueurs -->
                <div class="glass-card fade-in">
                    <h2>üèÜ Top Joueurs</h2>
                    <div id="playerRankings" class="rankings-list">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- STATS TAB -->
        <div class="tab-content" id="statsTab" style="display: none;">
            <div class="admin-stats-grid">
                <div class="admin-stat-card glass-card fade-in">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-value" id="totalUsers">0</div>
                    <div class="stat-label">Utilisateurs</div>
                </div>

                <div class="admin-stat-card glass-card fade-in">
                    <div class="stat-icon"></div>
                    <div class="stat-value" id="totalThemes">0</div>
                    <div class="stat-label">Th√®mes</div>
                </div>

                <div class="admin-stat-card glass-card fade-in">
                    <div class="stat-icon"></div>
                    <div class="stat-value" id="totalQuestions">0</div>
                    <div class="stat-label">Questions</div>
                </div>

                <div class="admin-stat-card glass-card fade-in">
                    <div class="stat-icon">üéØ</div>
                    <div class="stat-value" id="totalQuizzes">0</div>
                    <div class="stat-label">Quiz Jou√©s</div>
                </div>
            </div>
        </div>

        <!-- THEMES TAB -->
        <div class="tab-content" id="themesTab" style="display: none;">
            <div class="admin-section glass-card">
                <div class="section-header">
                    <h2>Gestion des Th√®mes</h2>
                    <button id="addThemeBtn" class="btn btn-primary">Ajouter un th√®me</button>
                </div>

                <div id="themesContainer" class="admin-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nom</th>
                                <th>Questions</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="themesTableBody">
                            <tr>
                                <td colspan="4" class="text-center">
                                    <div class="loading-spinner"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- QUESTIONS TAB -->
        <div class="tab-content" id="questionsTab" style="display: none;">
            <div class="admin-section glass-card">
                <div class="section-header">
                    <h2>Gestion des Questions</h2>
                    <div class="header-buttons">
                        <button id="addQuestionBtn" class="btn btn-primary">Ajouter une question</button>
                        <button id="importCSVBtn" class="btn btn-secondary">Importer CSV</button>
                    </div>
                </div>

                <div class="filters">
                    <select id="filterTheme" class="form-select">
                        <option value="">Tous les th√®mes</option>
                    </select>
                </div>

                <div id="questionsContainer" class="admin-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Question</th>
                                <th>Th√®me</th>
                                <th>Difficult√©</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="questionsTableBody">
                            <tr>
                                <td colspan="5" class="text-center">
                                    <div class="loading-spinner"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="pagination" id="questionsPagination"></div>
            </div>
        </div>

        <!-- USERS TAB -->
        <div class="tab-content" id="usersTab" style="display: none;">
            <div class="admin-section glass-card">
                <div class="section-header">
                    <h2>Gestion des Utilisateurs</h2>
                    <button id="addUserBtn" class="btn btn-primary">Ajouter un utilisateur</button>
                </div>

                <div id="usersContainer" class="admin-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Username</th>
                                <th>Email</th>
                                <th>R√¥les</th>
                                <th>Quiz</th>
                                <th>Score</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <tr>
                                <td colspan="7" class="text-center">
                                    <div class="loading-spinner"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- RECLAMATIONS TAB -->
        <div class="tab-content" id="reclamationsTab" style="display: none;">
            <div class="admin-section glass-card">
                <div class="section-header">
                    <h2>Gestion des R√©clamations</h2>
                    <div class="reclamation-stats" id="reclamationStats">
                        <span class="stat-badge">Total: <strong id="totalReclamations">0</strong></span>
                        <span class="stat-badge warning">En attente: <strong id="enAttenteReclamations">0</strong></span>
                        <span class="stat-badge info">En cours: <strong id="enCoursReclamations">0</strong></span>
                        <span class="stat-badge success">R√©solues: <strong id="resoluReclamations">0</strong></span>
                    </div>
                </div>

                <div class="filters" style="margin-bottom: 20px;">
                    <select id="filterStatus" class="form-select">
                        <option value="">Tous les statuts</option>
                        <option value="EN_ATTENTE">En attente</option>
                        <option value="EN_COURS">En cours</option>
                        <option value="RESOLU">R√©solu</option>
                        <option value="FERME">Ferm√©</option>
                    </select>
                </div>

                <div id="reclamationsContainer" class="admin-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Utilisateur</th>
                                <th>Sujet</th>
                                <th>Statut</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="reclamationsTableBody">
                            <tr>
                                <td colspan="6" class="text-center">
                                    <div class="loading-spinner"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- PROPOSITIONS TAB -->
    </div>

    <!-- MODALS -->
    <div id="themeModal" class="modal">
        <div class="modal-content glass-card">
            <div class="modal-header">
                <h2 id="themeModalTitle">Ajouter un th√®me</h2>
                <span class="close">&times;</span>
            </div>
            <form id="themeForm">
                <input type="hidden" id="themeId">
                <div class="form-group">
                    <label for="themeName">Nom du th√®me</label>
                    <input type="text" id="themeName" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-outline close-modal">Annuler</button>
                    <button type="submit" class="btn btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <div id="questionModal" class="modal">
        <div class="modal-content glass-card">
            <div class="modal-header">
                <h2 id="questionModalTitle">Ajouter une question</h2>
                <span class="close">&times;</span>
            </div>
            <form id="questionForm">
                <input type="hidden" id="questionId">
                <div class="form-group">
                    <label for="questionText">Question</label>
                    <textarea id="questionText" required rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="questionTheme">Th√®me</label>
                    <select id="questionTheme" required>
                        <option value="">S√©lectionnez un th√®me</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="questionDifficulty">Difficult√©</label>
                    <select id="questionDifficulty" required>
                        <option value="FACILE">Facile</option>
                        <option value="MOYEN">Moyen</option>
                        <option value="DIFFICILE">Difficile</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="correctAnswer">Bonne r√©ponse</label>
                    <input type="text" id="correctAnswer" required>
                </div>
                <div class="form-group">
                    <label for="wrongAnswer1">Mauvaise r√©ponse 1</label>
                    <input type="text" id="wrongAnswer1" required>
                </div>
                <div class="form-group">
                    <label for="wrongAnswer2">Mauvaise r√©ponse 2</label>
                    <input type="text" id="wrongAnswer2" required>
                </div>
                <div class="form-group">
                    <label for="wrongAnswer3">Mauvaise r√©ponse 3</label>
                    <input type="text" id="wrongAnswer3" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-outline close-modal">Annuler</button>
                    <button type="submit" class="btn btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <div id="csvModal" class="modal">
        <div class="modal-content glass-card">
            <div class="modal-header">
                <h2>Importer des questions (CSV)</h2>
                <span class="close">&times;</span>
            </div>
            <div class="csv-info">
                <p>Format attendu: Question,Theme,Difficulty,CorrectAnswer,WrongAnswer1,WrongAnswer2,WrongAnswer3</p>
            </div>
            <form id="csvForm">
                <div class="form-group">
                    <label for="csvFile">Fichier CSV</label>
                    <input type="file" id="csvFile" accept=".csv" required>
                </div>
                <div id="csvError" class="error-message" style="display: none;"></div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-outline close-modal">Annuler</button>
                    <button type="submit" class="btn btn-primary">Importer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- USER MODAL - VERSION CORRIG√âE -->
    <div id="userModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8);">
        <div class="modal-content glass-card" style="position: relative; margin: 5% auto; max-width: 600px; width: 90%;">
            <div class="modal-header">
                <h2 id="userModalTitle">Ajouter un utilisateur</h2>
                <span class="close">&times;</span>
            </div>
            <form id="userForm">
                <input type="hidden" id="userId">
                <div class="form-group">
                    <label for="userUsername">Nom d'utilisateur</label>
                    <input type="text" id="userUsername" required>
                </div>
                <div class="form-group">
                    <label for="userEmail">Email</label>
                    <input type="email" id="userEmail" required>
                </div>
                <div class="form-group" id="passwordGroup">
                    <label for="userPassword">Mot de passe</label>
                    <input type="password" id="userPassword" minlength="6">
                    <small class="text-muted" id="passwordHint" style="display: none;">Laissez vide pour garder le mot de passe actuel</small>
                </div>
                <div class="form-group">
                    <label for="userFirstName">Pr√©nom</label>
                    <input type="text" id="userFirstName" required>
                </div>
                <div class="form-group">
                    <label for="userLastName">Nom</label>
                    <input type="text" id="userLastName" required>
                </div>
                <div class="form-group">
                    <label for="userCountry">Pays</label>
                    <input type="text" id="userCountry" required>
                </div>
                <div class="form-group">
                    <label for="userRole">R√¥le</label>
                    <select id="userRole" required>
                        <option value="ROLE_USER">Utilisateur</option>
                        <option value="ROLE_ADMIN">Administrateur</option>
                    </select>
                </div>
                <div id="userError" class="error-message" style="display: none;"></div>

                <!-- BOUTONS AVEC STYLES FORC√âS -->
                <div class="modal-actions" style="display: flex !important; gap: 1rem; justify-content: flex-end; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <button type="button" class="btn btn-outline close-modal" style="min-width: 120px; padding: 0.75rem 1.5rem; font-weight: 600;">Annuler</button>
                    <button type="submit" class="btn btn-primary" id="userSubmitBtn" style="min-width: 120px; padding: 0.75rem 1.5rem; font-weight: 600;">Cr√©er</button>
                </div>
            </form>
        </div>
    </div>

    <!-- RECLAMATION MODAL -->
    <div id="reclamationModal" class="modal">
        <div class="modal-content glass-card">
            <div class="modal-header">
                <h2>R√©pondre √† la r√©clamation</h2>
                <span class="close">&times;</span>
            </div>
            <div class="reclamation-details" id="reclamationDetails">
                <div class="detail-item">
                    <strong>Utilisateur:</strong>
                    <span id="reclamationUsername"></span>
                </div>
                <div class="detail-item">
                    <strong>Sujet:</strong>
                    <span id="reclamationSubject"></span>
                </div>
                <div class="detail-item">
                    <strong>Description:</strong>
                    <p id="reclamationDescription"></p>
                </div>
                <div class="detail-item">
                    <strong>Date:</strong>
                    <span id="reclamationDate"></span>
                </div>
            </div>
            <form id="reclamationResponseForm">
                <input type="hidden" id="reclamationId">
                <div class="form-group">
                    <label for="adminResponse">Votre r√©ponse *</label>
                    <textarea id="adminResponse" required rows="5"
                              placeholder="Entrez votre r√©ponse √† l'utilisateur..."></textarea>
                </div>
                <div class="form-group">
                    <label for="reclamationStatus">Statut *</label>
                    <select id="reclamationStatus" required>
                        <option value="EN_COURS">En cours</option>
                        <option value="RESOLU">R√©solu</option>
                        <option value="FERME">Ferm√©</option>
                    </select>
                </div>
                <div id="reclamationError" class="error-message" style="display: none;"></div>
                <div class="modal-actions" style="display: flex !important; gap: 1rem; justify-content: flex-end; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <button type="button" class="btn btn-outline close-modal" style="min-width: 120px; padding: 0.75rem 1.5rem; font-weight: 600;">Annuler</button>
                    <button type="submit" class="btn btn-primary" style="min-width: 120px; padding: 0.75rem 1.5rem; font-weight: 600;">Envoyer la r√©ponse</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/js/config.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/admin.js"></script>
</body>
</html>
